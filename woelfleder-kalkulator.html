<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>W√∂lfleder - T√ºren & Tore Kalkulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --red-primary: #c8102e;
            --red-dark: #a00d25;
            --red-light: #e01e3a;
            --gray-bg: #f8f8f8;
            --gray-light: #e5e5e5;
            --gray-dark: #666666;
            --white: #ffffff;
            --text-dark: #2c2c2c;
            --border: #d0d0d0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gray-bg);
            color: var(--text-dark);
            line-height: 1.5;
        }

        /* Header mit Logo */
        .header {
            background: white;
            padding: 1.5rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-bottom: 4px solid var(--red-primary);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--red-primary);
            letter-spacing: -1px;
        }

        .logo-subtitle {
            font-size: 1.1rem;
            color: var(--gray-dark);
            font-weight: 500;
        }

        .header-info {
            text-align: right;
            font-size: 0.9rem;
            color: var(--gray-dark);
        }
        
        .home-button {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            background: var(--red-primary);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(200, 16, 46, 0.4);
            transition: all 0.3s;
            z-index: 999;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
        }
        
        .home-button:hover {
            background: var(--red-dark);
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(200, 16, 46, 0.5);
        }
        
        .home-button:active {
            transform: scale(0.95);
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2.5rem;
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .step {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            background: var(--gray-light);
            color: var(--gray-dark);
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s;
        }

        .step.active {
            background: var(--red-primary);
            color: white;
        }

        .step-number {
            width: 26px;
            height: 26px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 700;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--red-primary);
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--gray-light);
        }

        /* Customer Grid */
        .customer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.2rem;
        }

        .customer-card {
            background: var(--gray-bg);
            border: 2px solid var(--border);
            padding: 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            -webkit-tap-highlight-color: transparent;
        }

        .customer-card:hover,
        .customer-card:active {
            border-color: var(--red-primary);
            box-shadow: 0 4px 12px rgba(200, 16, 46, 0.15);
            transform: translateY(-2px);
        }

        .customer-name {
            font-size: 1.15rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .customer-info {
            color: var(--gray-dark);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .customer-gates {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            color: var(--red-primary);
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Type Grid with SVG Icons */
        .type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .type-card {
            background: white;
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 2rem 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            -webkit-tap-highlight-color: transparent;
        }

        .type-card:hover,
        .type-card:active {
            border-color: var(--red-primary);
            box-shadow: 0 6px 20px rgba(200, 16, 46, 0.15);
            transform: translateY(-4px);
        }

        .type-icon-svg {
            width: 80px;
            height: 80px;
            margin: 0 auto 1rem;
            fill: var(--red-primary);
        }

        .type-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.4rem;
        }

        .type-count {
            color: var(--gray-dark);
            font-size: 0.85rem;
        }

        /* Form */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.2rem;
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 4px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--red-primary);
        }

        .input-with-unit {
            position: relative;
        }

        .input-unit {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-dark);
            font-weight: 600;
            pointer-events: none;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--gray-light);
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            background: none;
            color: var(--gray-dark);
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            font-size: 0.95rem;
        }

        .tab-btn:hover {
            color: var(--red-primary);
        }

        .tab-btn.active {
            color: var(--red-primary);
            border-bottom-color: var(--red-primary);
        }

        /* Product List */
        .product-section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--red-primary);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--gray-light);
        }

        .product-list {
            display: grid;
            gap: 0.6rem;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .product-list::-webkit-scrollbar {
            width: 6px;
        }

        .product-list::-webkit-scrollbar-track {
            background: var(--gray-light);
            border-radius: 3px;
        }

        .product-list::-webkit-scrollbar-thumb {
            background: var(--red-primary);
            border-radius: 3px;
        }

        .product-item {
            background: var(--gray-bg);
            border: 2px solid transparent;
            border-radius: 6px;
            padding: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            -webkit-tap-highlight-color: transparent;
        }

        .product-item:hover,
        .product-item:active {
            background: white;
            border-color: var(--red-light);
        }

        .product-item.selected {
            background: var(--red-primary);
            color: white;
            border-color: var(--red-primary);
        }

        .product-name {
            font-weight: 500;
            flex: 1;
            font-size: 0.9rem;
        }

        .product-price {
            font-weight: 600;
            color: var(--red-primary);
            margin: 0 1rem;
            font-size: 0.9rem;
        }

        .product-item.selected .product-price {
            color: white;
        }

        .quantity-input {
            width: 70px;
            padding: 0.4rem;
            border: 2px solid white;
            border-radius: 4px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Layout */
        .layout-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 2rem;
        }

        /* Summary */
        .summary {
            background: var(--red-primary);
            color: white;
            border-radius: 8px;
            padding: 1.8rem;
            position: sticky;
            top: 2rem;
            height: fit-content;
        }

        .summary-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1.2rem;
            padding-bottom: 0.8rem;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 0.65rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 0.95rem;
        }

        .summary-value {
            font-weight: 600;
        }

        .summary-products {
            margin: 1.2rem 0;
        }

        .summary-product {
            background: rgba(255,255,255,0.1);
            padding: 0.65rem;
            border-radius: 4px;
            margin-bottom: 0.6rem;
            font-size: 0.85rem;
        }

        .summary-total {
            margin-top: 1.2rem;
            padding-top: 1.2rem;
            border-top: 2px solid rgba(255,255,255,0.3);
        }

        .summary-total .summary-value {
            font-size: 1.8rem;
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .btn-primary {
            background: var(--red-primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--red-dark);
        }

        .btn-secondary {
            background: var(--gray-light);
            color: var(--text-dark);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        /* Gate List */
        .gate-list {
            display: grid;
            gap: 1rem;
        }

        .gate-card {
            background: var(--gray-bg);
            border: 2px solid var(--border);
            border-radius: 6px;
            padding: 1.5rem;
        }

        .gate-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            gap: 1rem;
        }

        .gate-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .gate-type {
            color: var(--gray-dark);
            font-size: 0.85rem;
        }

        .gate-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .gate-detail {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.8rem;
            color: var(--gray-dark);
            margin-bottom: 0.2rem;
        }

        .detail-value {
            font-weight: 600;
            color: var(--red-primary);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--red-primary);
            margin-bottom: 1.5rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--gray-dark);
        }

        .empty-icon {
            font-size: 3rem;
            opacity: 0.3;
            margin-bottom: 1rem;
        }
        
        /* Highlight Animation */
        @keyframes highlight-pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(200, 16, 46, 0);
            }
            25% {
                transform: scale(1.02);
                box-shadow: 0 0 0 10px rgba(200, 16, 46, 0.3);
            }
            50% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(200, 16, 46, 0);
            }
            75% {
                transform: scale(1.02);
                box-shadow: 0 0 0 10px rgba(200, 16, 46, 0.3);
            }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .layout-grid {
                grid-template-columns: 1fr;
            }
            .summary {
                position: relative;
                top: 0;
            }
        }

        @media (max-width: 768px) {
            body {
                font-size: 14px;
            }

            .header {
                padding: 1rem 0;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
                padding: 0 1rem;
            }

            .logo {
                font-size: 2rem;
            }

            .logo-subtitle {
                font-size: 1rem;
            }

            .header-info {
                font-size: 0.8rem;
            }

            .container {
                margin: 1rem auto;
                padding: 0 1rem;
            }

            .progress-steps {
                flex-direction: column;
                gap: 0.5rem;
                padding: 1rem;
            }

            .step {
                width: 100%;
                justify-content: center;
            }

            .card {
                padding: 1.5rem 1rem;
            }

            .card-title {
                font-size: 1.2rem;
            }

            .customer-grid {
                grid-template-columns: 1fr;
            }

            .type-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            .type-card {
                padding: 1.5rem 1rem;
            }

            .type-icon-svg {
                width: 60px;
                height: 60px;
            }

            .type-name {
                font-size: 1rem;
            }

            .type-count {
                font-size: 0.8rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .form-group input,
            .form-group textarea {
                font-size: 16px; /* Verhindert Auto-Zoom auf iOS */
            }

            .tab-nav {
                flex-wrap: wrap;
                gap: 0.3rem;
            }

            .tab-btn {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
                flex: 1;
                min-width: 120px;
            }

            .product-list {
                max-height: 300px;
            }

            .product-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
                padding: 1rem;
            }

            .product-name {
                font-size: 0.9rem;
            }

            .product-price {
                margin: 0;
                font-size: 0.85rem;
            }

            .quantity-input {
                width: 100%;
                padding: 0.6rem;
                font-size: 16px; /* Verhindert Auto-Zoom auf iOS */
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                padding: 1rem;
                font-size: 1rem;
            }

            .summary {
                padding: 1.5rem 1rem;
            }

            .summary-title {
                font-size: 1.2rem;
            }

            .summary-row {
                font-size: 0.9rem;
            }

            .summary-total .summary-value {
                font-size: 1.5rem;
            }

            .gate-card {
                padding: 1rem;
            }
            
            .gate-header {
                flex-direction: column;
                gap: 1rem;
            }

            .gate-details {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.8rem;
            }

            .modal {
                padding: 1rem;
            }

            .modal-content {
                padding: 1.5rem 1rem;
            }
            
            .home-button {
                width: 50px;
                height: 50px;
                bottom: 1rem;
                right: 1rem;
                font-size: 1.2rem;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 1.5rem;
            }

            .logo-subtitle {
                font-size: 0.9rem;
            }

            .type-grid {
                grid-template-columns: 1fr;
            }

            .gate-details {
                grid-template-columns: 1fr;
            }

            .tab-btn {
                min-width: 100px;
                font-size: 0.8rem;
                padding: 0.5rem 0.7rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo-container">
                <div>
                    <div class="logo">W√ñLFLEDER</div>
                    <div class="logo-subtitle">T√ºren & Tore Kalkulator</div>
                </div>
            </div>
            <div class="header-info">
                <div><strong>W√∂lfleder GmbH</strong></div>
                <div>Kopfinger Stra√üe 15, 4771 Sigharting</div>
                <div>Tel: 07766/2692-0</div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="progress-steps" id="stepsNav"></div>
        <div id="app"></div>
    </div>
    
    <button class="home-button" onclick="goToHome()" title="Hauptmen√º">üè†</button>

    <div id="customerModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">Neuer Kunde</div>
            <div id="modalBody"></div>
        </div>
    </div>

    <div id="gateModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">Tor speichern</div>
            <div id="gateModalBody"></div>
        </div>
    </div>

    <script>
        // SVG Icons f√ºr verschiedene Tor-Typen
        const icons = {
            door: `<svg viewBox="0 0 100 100" class="type-icon-svg">
                <rect x="20" y="10" width="60" height="80" fill="none" stroke="currentColor" stroke-width="3"/>
                <rect x="25" y="15" width="50" height="70" fill="currentColor" opacity="0.1"/>
                <circle cx="75" cy="50" r="3" fill="currentColor"/>
                <line x1="20" y1="90" x2="80" y2="90" stroke="currentColor" stroke-width="2"/>
            </svg>`,
            wingGate: `<svg viewBox="0 0 100 100" class="type-icon-svg">
                <rect x="15" y="20" width="35" height="60" fill="currentColor" opacity="0.2"/>
                <rect x="50" y="20" width="35" height="60" fill="currentColor" opacity="0.2"/>
                <path d="M 15 20 L 50 50 L 15 80" fill="none" stroke="currentColor" stroke-width="3"/>
                <path d="M 85 20 L 50 50 L 85 80" fill="none" stroke="currentColor" stroke-width="3"/>
                <line x1="15" y1="80" x2="85" y2="80" stroke="currentColor" stroke-width="2"/>
            </svg>`,
            pushGate: `<svg viewBox="0 0 100 100" class="type-icon-svg">
                <rect x="30" y="20" width="50" height="60" fill="currentColor" opacity="0.2"/>
                <rect x="30" y="20" width="50" height="60" fill="none" stroke="currentColor" stroke-width="3"/>
                <line x1="40" y1="20" x2="40" y2="80" stroke="currentColor" stroke-width="2"/>
                <line x1="60" y1="20" x2="60" y2="80" stroke="currentColor" stroke-width="2"/>
                <path d="M 20 50 L 30 50 M 25 45 L 30 50 L 25 55" fill="none" stroke="currentColor" stroke-width="2"/>
            </svg>`,
            slidingDoor: `<svg viewBox="0 0 100 100" class="type-icon-svg">
                <rect x="15" y="20" width="40" height="60" fill="currentColor" opacity="0.1"/>
                <rect x="35" y="20" width="40" height="60" fill="currentColor" opacity="0.3"/>
                <rect x="15" y="20" width="40" height="60" fill="none" stroke="currentColor" stroke-width="3"/>
                <rect x="35" y="20" width="40" height="60" fill="none" stroke="currentColor" stroke-width="3"/>
                <line x1="15" y1="15" x2="85" y2="15" stroke="currentColor" stroke-width="2"/>
            </svg>`
        };

        // Allgemeines Zubeh√∂r f√ºr alle Kategorien
        const generalAccessories = [
            { id: 200, name: "Betoplan", price: 23, unit: "m¬≤" },
            { id: 201, name: "Blech verzinkt 0,75mm", price: 15, unit: "m¬≤" },
            { id: 202, name: "Garagentorblech verzinkt", price: 27, unit: "m¬≤" },
            { id: 203, name: "Garagentorblech verzinkt in Teak", price: 47, unit: "m¬≤" },
            { id: 204, name: "Niro-Blech 1mm", price: 78, unit: "m¬≤" },
            { id: 205, name: "KU-Profil wei√ü 18mm", price: 27, unit: "m¬≤" },
            { id: 206, name: "L√§rchenholz", price: 17, unit: "m¬≤" },
            { id: 207, name: "3-Schichtplatte NR: 10010892", price: 27, unit: "m¬≤" },
            { id: 208, name: "3-Schichtplatte NR: 10001376", price: 40, unit: "m¬≤" },
            { id: 209, name: "3-Schichtplatte NR: 10001377", price: 52, unit: "m¬≤" },
            { id: 210, name: "3-Schichtplatte NR: 10010888", price: 54, unit: "m¬≤" },
            { id: 211, name: "3-Schichtplatte NR: 10010889", price: 76, unit: "m¬≤" },
            { id: 212, name: "3-Schichtplatte NR: 10001378", price: 84, unit: "m¬≤" },
            { id: 213, name: "3-Schichtplatte NR: 10010890", price: 84, unit: "m¬≤" },
            { id: 214, name: "3-Schichtplatte NR: 10001379", price: 115, unit: "m¬≤" },
            { id: 215, name: "3-Schichtplatte NR: 10010891", price: 120, unit: "m¬≤" },
            { id: 216, name: "KU-Verglasung 8mm", price: 68, unit: "m¬≤" },
            { id: 217, name: "KU-Verglasung 16mm", price: 91, unit: "m¬≤" },
            { id: 218, name: "Plexiglas 5mm", price: 119, unit: "m¬≤" },
            { id: 219, name: "Isolierglas", price: 208, unit: "m¬≤" },
            { id: 220, name: "Schl√∂sser gleichsperrend", price: 5.5, unit: "St√ºck" },
            { id: 221, name: "Zylinderschloss", price: 20.5, unit: "St√ºck" },
            { id: 222, name: "Zylinderschloss, gleichsperrend", price: 26, unit: "St√ºck" },
            { id: 223, name: "Torhalter KU", price: 12.5, unit: "St√ºck" },
            { id: 224, name: "Gegenhalter Gummi", price: 12.5, unit: "St√ºck" },
            { id: 225, name: "Gummi 4mm", price: 54, unit: "lm" },
            { id: 226, name: "Katzent√ºrl", price: 162, unit: "St√ºck" },
            { id: 227, name: "KU-Glas 8mm in ganzen Platten", price: 25, unit: "m¬≤" },
            { id: 228, name: "KU-Glas 8mm zugeschnitten", price: 32.5, unit: "m¬≤" },
            { id: 229, name: "KU-Glas 16mm in ganzen Platten", price: 46.6, unit: "m¬≤" },
            { id: 230, name: "KU-Glas 16mm zugeschnitten", price: 60.6, unit: "m¬≤" },
            { id: 231, name: "KU H-Profil f√ºr 16mm Glas", price: 17, unit: "lm" },
            { id: 232, name: "Alu U-Profil 16mm nicht montiert", price: 5, unit: "lm" },
            { id: 233, name: "Alu U-Profil 16mm montiert", price: 9, unit: "lm" },
            { id: 234, name: "Alu U-Profil 16mm 25x25x25x2 nicht montiert", price: 6, unit: "lm" },
            { id: 235, name: "Spezial Alu U-Profil nicht montiert", price: 9, unit: "lm" },
            { id: 236, name: "Spezial Alu U-Profil montiert", price: 13, unit: "lm" },
            { id: 237, name: "Betoplan in ganzen Platten", price: 21.5, unit: "m¬≤" },
            { id: 238, name: "Betoplan zugeschnitten", price: 36.5, unit: "m¬≤" }
        ];

        // Produktdaten
        const productsByCategory = {
            'T√ºren': {
                main: [
                    { id: 1, name: "T√ºre aussen Holz/innen Holz", price: 225, unit: "m¬≤" },
                    { id: 2, name: "T√ºre mit einwandiger Holzf√ºllung", price: 202, unit: "m¬≤" },
                    { id: 3, name: "T√ºre ohne F√ºllung", price: 168, unit: "m¬≤" },
                    { id: 4, name: "Doppelfl√ºglig bis max 4m¬≤", price: 139, unit: "m¬≤" },
                    { id: 5, name: "Waagrecht geteilte T√ºr", price: 132, unit: "m¬≤" },
                    { id: 6, name: "Fensterschutzgitter f√ºr Pferdeboxen", price: 131, unit: "m¬≤" }
                ],
                accessories: [
                    { id: 7, name: "Versenkter Muschelgriff", price: 39, unit: "St√ºck" },
                    { id: 8, name: "Feststehendes Fenster ohne Glas", price: 55, unit: "m¬≤" },
                    { id: 9, name: "Schiebefenster ohne Glas", price: 128, unit: "St√ºck" },
                    { id: 10, name: "Feststehende Oberlichte ohne Glas", price: 147, unit: "m¬≤" },
                    { id: 11, name: "Feststehende Oberlichte mit Kippfenster ohne Glas", price: 189, unit: "m¬≤" }
                ]
            },
            'Fl√ºgeltore und Falttore': {
                main: [
                    { id: 12, name: "Fl√ºgeltor bis 4 m¬≤", price: 225, unit: "m¬≤" },
                    { id: 13, name: "Fl√ºgeltor bis 7 m¬≤", price: 221, unit: "m¬≤" },
                    { id: 14, name: "Fl√ºgeltor bis 11 m¬≤", price: 185, unit: "m¬≤" },
                    { id: 15, name: "Fl√ºgeltor bis 15 m¬≤", price: 161, unit: "m¬≤" },
                    { id: 16, name: "Fl√ºgeltor bis 20 m¬≤", price: 145, unit: "m¬≤" },
                    { id: 17, name: "Fl√ºgeltor √ºber 20 m¬≤", price: 139, unit: "m¬≤" },
                    { id: 23, name: "Falttor bis 4 m¬≤", price: 225, unit: "m¬≤" },
                    { id: 24, name: "Falttor bis 7 m¬≤", price: 221, unit: "m¬≤" },
                    { id: 25, name: "Falttor bis 11 m¬≤", price: 185, unit: "m¬≤" },
                    { id: 26, name: "Falttor bis 15 m¬≤", price: 161, unit: "m¬≤" },
                    { id: 27, name: "Falttor bis 20 m¬≤", price: 145, unit: "m¬≤" },
                    { id: 28, name: "Falttor √ºber 20 m¬≤", price: 139, unit: "m¬≤" }
                ],
                accessories: [
                    { id: 18, name: "mit einwandiger Holzf√ºllung", price: -13, unit: "m¬≤" },
                    { id: 19, name: "ohne F√ºllung", price: -37, unit: "m¬≤" },
                    { id: 20, name: "Geht√ºre eingebaut", price: 320, unit: "St√ºck" },
                    { id: 21, name: "Waagrecht geteiltes Tor", price: 148, unit: "m¬≤" },
                    { id: 22, name: "zus√§tzl. Exzenter-Feststellriegel", price: 19, unit: "St√ºck" },
                    { id: 29, name: "Aufpreis zum Fl√ºgeltor je Faltung", price: 182, unit: "St√ºck" },
                    { id: 30, name: "F√ºhrungsschiene mit Rollen und Halterung", price: 47, unit: "lm" },
                    { id: 31, name: "Feststehendes Fenster ohne Glas", price: 76, unit: "m¬≤" },
                    { id: 32, name: "Schiebefenster ohne Glas", price: 147, unit: "m¬≤" },
                    { id: 33, name: "Schiebefenster zweiteilig ohne Glas", price: 264, unit: "m¬≤" }
                ]
            },
            'Schubtore': {
                main: [
                    { id: 34, name: "Schubtor bis 4 m¬≤", price: 207, unit: "m¬≤" },
                    { id: 35, name: "Schubtor bis 7 m¬≤", price: 173, unit: "m¬≤" },
                    { id: 36, name: "Schubtor bis 11 m¬≤", price: 144, unit: "m¬≤" },
                    { id: 37, name: "Schubtor bis 15 m¬≤", price: 124, unit: "m¬≤" },
                    { id: 38, name: "Schubtor bis 20 m¬≤", price: 108, unit: "m¬≤" },
                    { id: 39, name: "Schubtor √ºber 20 m¬≤", price: 105, unit: "m¬≤" },
                    { id: 43, name: "Schiebet√ºr bis 3m¬≤", price: 195, unit: "m¬≤" }
                ],
                accessories: [
                    { id: 40, name: "Minderpreis einwandige F√ºllung", price: -13, unit: "m¬≤" },
                    { id: 41, name: "ohne F√ºllung", price: -37, unit: "m¬≤" },
                    { id: 42, name: "Teilung √ºber 2,5m", price: 182, unit: "m¬≤" },
                    { id: 44, name: "feststehendes Fenster ohne Glas", price: 56, unit: "m¬≤" },
                    { id: 45, name: "Schiebefenster innen (nur bei einwandiger F√ºllung)", price: 139, unit: "m¬≤" },
                    { id: 46, name: "Schiebefenster aussen", price: 165, unit: "m¬≤" },
                    { id: 47, name: "Geht√ºr eingebaut", price: 320, unit: "St√ºck" },
                    { id: 48, name: "Schubtorverschluss in Mauerleibung", price: 33, unit: "St√ºck" },
                    { id: 49, name: "Versenkter Muschelgriff mit Niro-Klappring", price: 39, unit: "St√ºck" },
                    { id: 50, name: "Hakenschloss", price: 106, unit: "St√ºck" },
                    { id: 51, name: "Anschlagschiene senkrecht", price: 27, unit: "lm" },
                    { id: 52, name: "Gekr√ºmmte Laufschiene f√ºr doppelte Anordnung", price: 109, unit: "lm" },
                    { id: 53, name: "Abdichtb√ºrste", price: 29, unit: "lm" },
                    { id: 54, name: "Bodenf√ºhrung auf Mauer zum and√ºbeln", price: 22, unit: "St√ºck" }
                ]
            },
            'Schiebet√ºren': {
                main: [
                    { id: 55, name: "Betoplan", price: 23, unit: "m¬≤" },
                    { id: 56, name: "Blech verzinkt 0,75mm", price: 15, unit: "m¬≤" },
                    { id: 57, name: "Garagentorblech verzinkt", price: 27, unit: "m¬≤" },
                    { id: 58, name: "Garagentorblech verzinkt in Teak", price: 47, unit: "m¬≤" },
                    { id: 59, name: "Niro-Blech 1mm", price: 78, unit: "m¬≤" },
                    { id: 60, name: "L√§rchenholz", price: 17, unit: "m¬≤" },
                    { id: 93, name: "KU-Profil wei√ü 18mm", price: 27, unit: "m¬≤" }
                ],
                accessories: [
                    { id: 61, name: "3-Schichtplatte NR: 10010892", price: 27, unit: "m¬≤" },
                    { id: 62, name: "3-Schichtplatte NR: 10001376", price: 40, unit: "m¬≤" },
                    { id: 63, name: "3-Schichtplatte NR: 10001377", price: 52, unit: "m¬≤" },
                    { id: 64, name: "3-Schichtplatte NR: 10010888", price: 54, unit: "m¬≤" },
                    { id: 65, name: "3-Schichtplatte NR: 10010889", price: 76, unit: "m¬≤" },
                    { id: 66, name: "3-Schichtplatte NR: 10001378", price: 84, unit: "m¬≤" },
                    { id: 67, name: "3-Schichtplatte NR: 10010890", price: 84, unit: "m¬≤" },
                    { id: 68, name: "3-Schichtplatte NR: 10001379", price: 115, unit: "m¬≤" },
                    { id: 69, name: "3-Schichtplatte NR: 10010891", price: 120, unit: "m¬≤" },
                    { id: 70, name: "KU-Verglasung 8mm", price: 68, unit: "m¬≤" },
                    { id: 71, name: "KU-Verglasung 16mm", price: 91, unit: "m¬≤" },
                    { id: 72, name: "Plexiglas 5mm", price: 119, unit: "m¬≤" },
                    { id: 73, name: "Isolierglas", price: 208, unit: "m¬≤" },
                    { id: 74, name: "Schl√∂sser gleichsperrend", price: 5.5, unit: "St√ºck" },
                    { id: 75, name: "Zylinderschloss", price: 20.5, unit: "St√ºck" },
                    { id: 76, name: "Zylinderschloss, gleichsperrend", price: 26, unit: "St√ºck" },
                    { id: 77, name: "Torhalter KU", price: 12.5, unit: "St√ºck" },
                    { id: 78, name: "Gegenhalter Gummi", price: 12.5, unit: "St√ºck" },
                    { id: 79, name: "Gummi 4mm", price: 54, unit: "lm" },
                    { id: 80, name: "Katzent√ºrl", price: 162, unit: "St√ºck" },
                    { id: 81, name: "KU-Glas 8mm in ganzen Platten", price: 25, unit: "m¬≤" },
                    { id: 82, name: "KU-Glas 8mm zugeschnitten", price: 32.5, unit: "m¬≤" },
                    { id: 83, name: "KU-Glas 16mm in ganzen Platten", price: 46.6, unit: "m¬≤" },
                    { id: 84, name: "KU-Glas 16mm zugeschnitten", price: 60.6, unit: "m¬≤" },
                    { id: 85, name: "KU H-Profil f√ºr 16mm Glas", price: 17, unit: "lm" },
                    { id: 86, name: "Alu U-Profil 16mm nicht montiert", price: 5, unit: "lm" },
                    { id: 87, name: "Alu U-Profil 16mm montiert", price: 9, unit: "lm" },
                    { id: 88, name: "Alu U-Profil 16mm 25x25x25x2 nicht montiert", price: 6, unit: "lm" },
                    { id: 89, name: "Spezial Alu U-Profil nicht montiert", price: 9, unit: "lm" },
                    { id: 90, name: "Spezial Alu U-Profil montiert", price: 13, unit: "lm" },
                    { id: 91, name: "Betoplan in ganzen Platten", price: 21.5, unit: "m¬≤" },
                    { id: 92, name: "Betoplan zugeschnitten", price: 36.5, unit: "m¬≤" }
                ]
            }
        };

        const gateTypes = {
            'T√ºren': { icon: 'door', name: 'T√ºren' },
            'Fl√ºgeltore und Falttore': { icon: 'wingGate', name: 'Fl√ºgel- & Falttore' },
            'Schubtore': { icon: 'pushGate', name: 'Schubtore' },
            'Schiebet√ºren': { icon: 'slidingDoor', name: 'Schiebet√ºren' }
        };

        const allProducts = [...generalAccessories];
        Object.values(productsByCategory).forEach(cat => {
            allProducts.push(...cat.main, ...cat.accessories);
        });

        let state = {
            customers: JSON.parse(localStorage.getItem('woelfleder_customers') || '[]'),
            currentCustomer: null,
            currentCustomerEdit: null, // F√ºr Kunden-Bearbeitung
            currentGate: {
                name: '',
                gateType: null,
                breite: 150,
                hoehe: 210,
                glashoehe: 0,
                selectedProducts: [],
                notizen: '',
                aufschlag: 20
            },
            view: 'customer-select',
            activeTab: 'main',
            showAllProducts: false // F√ºr ausklappbare Produktliste
        };

        function saveState() {
            localStorage.setItem('woelfleder_customers', JSON.stringify(state.customers));
        }

        function getProductById(id) {
            return allProducts.find(p => p.id === id);
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('de-AT', {
                style: 'currency',
                currency: 'EUR'
            }).format(price);
        }

        function formatArea(area) {
            return area.toFixed(2) + ' m¬≤';
        }

        function calculateAreas() {
            const gesamtflaeche = (state.currentGate.breite * state.currentGate.hoehe) / 10000;
            const glasflaeche = (state.currentGate.breite * state.currentGate.glashoehe) / 10000;
            const torflaeche = gesamtflaeche - glasflaeche;
            return { gesamtflaeche, glasflaeche, torflaeche };
        }

        function calculateTotal() {
            const { gesamtflaeche, glasflaeche, torflaeche } = calculateAreas();
            let total = 0;

            state.currentGate.selectedProducts.forEach(product => {
                const item = getProductById(product.id);
                if (!item) return;

                if (item.unit === 'm¬≤') {
                    if (item.name.toLowerCase().includes('fenster') || 
                        item.name.toLowerCase().includes('glas') ||
                        item.name.toLowerCase().includes('verglasung') ||
                        item.name.toLowerCase().includes('oberlichte')) {
                        total += item.price * glasflaeche * product.quantity;
                    } else {
                        total += item.price * torflaeche * product.quantity;
                    }
                } else {
                    total += item.price * product.quantity;
                }
            });

            return total;
        }

        function updateSteps() {
            const steps = ['Kunde', 'Tor-Typ', 'Konfiguration'];
            let currentStep = 0;
            
            if (state.view === 'customer-select') currentStep = 0;
            else if (state.view === 'type-select') currentStep = 1;
            else if (state.view === 'gate-config') currentStep = 2;

            document.getElementById('stepsNav').innerHTML = steps.map((step, i) => `
                <div class="step ${i === currentStep ? 'active' : ''}">
                    <div class="step-number">${i + 1}</div>
                    <span>${step}</span>
                </div>
            `).join('');
        }

        function openCustomerModal(customerId = null) {
            const modal = document.getElementById('customerModal');
            const modalTitle = modal.querySelector('.modal-title');
            const body = document.getElementById('modalBody');
            
            // Lade Kundendaten wenn Bearbeitung
            let customer = null;
            if (customerId) {
                customer = state.customers.find(c => c.id === customerId);
                state.currentCustomerEdit = customer;
                modalTitle.textContent = 'Kunde bearbeiten';
            } else {
                state.currentCustomerEdit = null;
                modalTitle.textContent = 'Neuer Kunde';
            }
            
            body.innerHTML = `
                <div class="form-grid">
                    <div class="form-group">
                        <label>Name *</label>
                        <input type="text" id="customerName" placeholder="Max Mustermann" value="${customer?.name || ''}">
                    </div>
                    <div class="form-group">
                        <label>Firma</label>
                        <input type="text" id="customerCompany" placeholder="Mustermann GmbH" value="${customer?.company || ''}">
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Adresse</label>
                        <input type="text" id="customerAddress" placeholder="Musterstra√üe 123" value="${customer?.address || ''}">
                    </div>
                    <div class="form-group">
                        <label>PLZ / Ort</label>
                        <input type="text" id="customerCity" placeholder="4771 Sigharting" value="${customer?.city || ''}">
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Telefon</label>
                        <input type="text" id="customerPhone" placeholder="+43 7766 2692" value="${customer?.phone || ''}">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="customerEmail" placeholder="office@mustermann.at" value="${customer?.email || ''}">
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="closeCustomerModal()">Abbrechen</button>
                    <button class="btn btn-primary" onclick="saveCustomer()">${customer ? 'Aktualisieren' : 'Kunde erstellen'}</button>
                </div>
            `;
            
            modal.classList.add('active');
        }

        function closeCustomerModal() {
            document.getElementById('customerModal').classList.remove('active');
            state.currentCustomerEdit = null;
        }

        function saveCustomer() {
            const name = document.getElementById('customerName').value.trim();
            
            if (!name) {
                alert('Bitte geben Sie einen Namen ein.');
                return;
            }
            
            const customerData = {
                name,
                company: document.getElementById('customerCompany').value.trim(),
                address: document.getElementById('customerAddress').value.trim(),
                city: document.getElementById('customerCity').value.trim(),
                phone: document.getElementById('customerPhone').value.trim(),
                email: document.getElementById('customerEmail').value.trim()
            };
            
            if (state.currentCustomerEdit) {
                // Kunde bearbeiten
                const customerIndex = state.customers.findIndex(c => c.id === state.currentCustomerEdit.id);
                if (customerIndex >= 0) {
                    state.customers[customerIndex] = {
                        ...state.customers[customerIndex],
                        ...customerData,
                        updatedAt: new Date().toISOString()
                    };
                }
            } else {
                // Neuer Kunde
                const newCustomer = {
                    id: Date.now().toString(),
                    ...customerData,
                    gates: [],
                    createdAt: new Date().toISOString()
                };
                state.customers.push(newCustomer);
            }
            
            saveState();
            closeCustomerModal();
            render();
        }
        
        function editCustomer(customerId) {
            openCustomerModal(customerId);
        }
        
        function deleteCustomer(customerId) {
            const customer = state.customers.find(c => c.id === customerId);
            const gateCount = (customer?.gates || []).length;
            
            let confirmMessage = 'Kunde wirklich l√∂schen?';
            if (gateCount > 0) {
                confirmMessage = `Kunde wirklich l√∂schen? Es werden ${gateCount} Tor${gateCount !== 1 ? 'e' : ''} mit gel√∂scht!`;
            }
            
            if (!confirm(confirmMessage)) return;
            
            state.customers = state.customers.filter(c => c.id !== customerId);
            saveState();
            render();
        }

        function selectCustomer(customerId) {
            state.currentCustomer = state.customers.find(c => c.id === customerId);
            state.view = 'type-select';
            resetCurrentGate();
            render();
        }

        function resetCurrentGate() {
            state.currentGate = {
                name: '',
                gateType: null,
                breite: 150,
                hoehe: 210,
                glashoehe: 0,
                selectedProducts: [],
                notizen: '',
                aufschlag: 20
            };
            state.activeTab = 'main';
        }

        function selectGateType(type) {
            state.currentGate.gateType = type;
            state.view = 'gate-config';
            state.activeTab = 'main';
            
            // Automatisch das passende Hauptprodukt ausw√§hlen basierend auf Gesamtfl√§che
            autoSelectMainProduct();
            
            render();
        }
        
        function autoSelectMainProduct() {
            const { gesamtflaeche } = calculateAreas();
            const categoryData = productsByCategory[state.currentGate.gateType];
            
            if (!categoryData || !categoryData.main) return;
            
            let selectedProduct = null;
            
            // Logik f√ºr verschiedene Kategorien
            if (state.currentGate.gateType === 'T√ºren') {
                // F√ºr T√ºren: Standard "T√ºre aussen Holz/innen Holz" w√§hlen
                selectedProduct = categoryData.main.find(p => p.name.includes('aussen Holz/innen Holz'));
            } else if (state.currentGate.gateType === 'Fl√ºgeltore und Falttore') {
                // Fl√ºgeltor basierend auf Fl√§che
                if (gesamtflaeche <= 4) {
                    selectedProduct = categoryData.main.find(p => p.name.includes('Fl√ºgeltor bis 4'));
                } else if (gesamtflaeche <= 7) {
                    selectedProduct = categoryData.main.find(p => p.name.includes('Fl√ºgeltor bis 7'));
                } else if (gesamtflaeche <= 11) {
                    selectedProduct = categoryData.main.find(p => p.name.includes('Fl√ºgeltor bis 11'));
                } else if (gesamtflaeche <= 15) {
                    selectedProduct = categoryData.main.find(p => p.name.includes('Fl√ºgeltor bis 15'));
                } else if (gesamtflaeche <= 20) {
                    selectedProduct = categoryData.main.find(p => p.name.includes('Fl√ºgeltor bis 20'));
                } else {
                    selectedProduct = categoryData.main.find(p => p.name.includes('Fl√ºgeltor √ºber 20'));
                }
            } else if (state.currentGate.gateType === 'Schubtore') {
                // Schubtor basierend auf Fl√§che
                if (gesamtflaeche <= 3) {
                    selectedProduct = categoryData.main.find(p => p.name.includes('Schiebet√ºr bis 3'));
                } else if (gesamtflaeche <= 4) {
                    selectedProduct = categoryData.main.find(p => p.name.includes('Schubtor bis 4'));
                } else if (gesamtflaeche <= 7) {
                    selectedProduct = categoryData.main.find(p => p.name.includes('Schubtor bis 7'));
                } else if (gesamtflaeche <= 11) {
                    selectedProduct = categoryData.main.find(p => p.name.includes('Schubtor bis 11'));
                } else if (gesamtflaeche <= 15) {
                    selectedProduct = categoryData.main.find(p => p.name.includes('Schubtor bis 15'));
                } else if (gesamtflaeche <= 20) {
                    selectedProduct = categoryData.main.find(p => p.name.includes('Schubtor bis 20'));
                } else {
                    selectedProduct = categoryData.main.find(p => p.name.includes('Schubtor √ºber 20'));
                }
            } else if (state.currentGate.gateType === 'Schiebet√ºren') {
                // F√ºr Schiebet√ºren: Standard "Betoplan"
                selectedProduct = categoryData.main.find(p => p.name === 'Betoplan');
            }
            
            // Produkt ausw√§hlen wenn gefunden und noch nicht ausgew√§hlt
            if (selectedProduct && !state.currentGate.selectedProducts.find(p => p.id === selectedProduct.id)) {
                state.currentGate.selectedProducts.push({ id: selectedProduct.id, quantity: 1 });
                
                // Wechsle zum Hauptprodukte-Tab
                state.activeTab = 'main';
                
                return selectedProduct.id; // ID zur√ºckgeben f√ºr Scroll/Highlight
            }
            
            return selectedProduct?.id || null;
        }
        
        function editGate(gateId) {
            const gate = state.currentCustomer.gates.find(g => g.id === gateId);
            if (!gate) return;
            
            // Tor-Daten in currentGate laden
            state.currentGate = {
                id: gate.id, // ID mitf√ºhren f√ºr Update
                name: gate.name,
                gateType: gate.gateType,
                breite: gate.breite,
                hoehe: gate.hoehe,
                glashoehe: gate.glashoehe,
                selectedProducts: JSON.parse(JSON.stringify(gate.selectedProducts)), // Deep copy
                notizen: gate.notizen,
                aufschlag: gate.aufschlag
            };
            
            state.view = 'gate-config';
            state.activeTab = 'main';
            render();
        }

        function backToCustomers() {
            state.view = 'customer-select';
            state.currentCustomer = null;
            resetCurrentGate();
            render();
        }
        
        function goToHome() {
            if (state.view !== 'customer-select') {
                if (state.currentGate.selectedProducts.length > 0 && !state.currentGate.id) {
                    if (!confirm('Nicht gespeicherte √Ñnderungen gehen verloren. Trotzdem zum Hauptmen√º?')) {
                        return;
                    }
                }
            }
            state.view = 'customer-select';
            state.currentCustomer = null;
            resetCurrentGate();
            render();
        }

        function backToTypeSelect() {
            state.view = 'type-select';
            state.currentGate.selectedProducts = [];
            render();
        }

        function setActiveTab(tab) {
            state.activeTab = tab;
            render();
        }

        function toggleProduct(productId) {
            const index = state.currentGate.selectedProducts.findIndex(p => p.id === productId);
            
            if (index >= 0) {
                state.currentGate.selectedProducts.splice(index, 1);
            } else {
                state.currentGate.selectedProducts.push({ id: productId, quantity: 1 });
            }
            
            render();
        }

        function updateQuantity(productId, value) {
            const product = state.currentGate.selectedProducts.find(p => p.id === productId);
            if (product) {
                product.quantity = parseFloat(value) || 1;
                // Nur Summary aktualisieren, nicht alles neu rendern
                clearTimeout(renderTimeout);
                renderTimeout = setTimeout(() => {
                    renderSummaryOnly();
                }, 300);
            }
        }

        function openGateModal() {
            const modal = document.getElementById('gateModal');
            const body = document.getElementById('gateModalBody');
            
            const autoSummary = generateProductSummary();
            const currentNotizen = state.currentGate.notizen || '';
            
            body.innerHTML = `
                <div class="form-group">
                    <label>Tor-Bezeichnung *</label>
                    <input type="text" id="gateName" placeholder="z.B. Haupttor" value="${state.currentGate.name}">
                </div>
                <div class="form-group">
                    <label>Notizen ${!currentNotizen ? '(wird automatisch generiert)' : ''}</label>
                    <textarea id="gateNotizen" rows="4" placeholder="${autoSummary}">${currentNotizen}</textarea>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="closeGateModal()">Abbrechen</button>
                    <button class="btn btn-primary" onclick="saveGate()">${state.currentGate.id ? 'Aktualisieren' : 'Speichern'}</button>
                </div>
            `;
            
            modal.classList.add('active');
        }

        function closeGateModal() {
            document.getElementById('gateModal').classList.remove('active');
        }

        function generateProductSummary() {
            const products = state.currentGate.selectedProducts.map(sp => {
                const product = getProductById(sp.id);
                if (!product) return '';
                return sp.quantity > 1 ? `${sp.quantity}x ${product.name}` : product.name;
            }).filter(p => p);
            
            return products.join(', ');
        }
        
        function saveGate() {
            const name = document.getElementById('gateName').value.trim();
            let notizen = document.getElementById('gateNotizen').value.trim();
            
            if (!name) {
                alert('Bitte geben Sie eine Bezeichnung ein.');
                return;
            }
            
            // Auto-generiere Notizen wenn leer
            if (!notizen) {
                notizen = generateProductSummary();
            }
            
            const { gesamtflaeche, glasflaeche, torflaeche } = calculateAreas();
            const subtotal = calculateTotal();
            const aufschlagBetrag = subtotal * (state.currentGate.aufschlag / 100);
            const exklusiveMwst = subtotal + aufschlagBetrag;
            const inklMwst = exklusiveMwst * 1.2;
            
            const gate = {
                id: state.currentGate.id || Date.now().toString(),
                name,
                gateType: state.currentGate.gateType,
                notizen,
                breite: state.currentGate.breite,
                hoehe: state.currentGate.hoehe,
                glashoehe: state.currentGate.glashoehe,
                gesamtflaeche,
                glasflaeche,
                torflaeche,
                selectedProducts: state.currentGate.selectedProducts,
                aufschlag: state.currentGate.aufschlag,
                subtotal,
                aufschlagBetrag,
                exklusiveMwst,
                inklMwst,
                createdAt: state.currentGate.id ? 
                    (state.customers.find(c => c.id === state.currentCustomer.id).gates.find(g => g.id === state.currentGate.id)?.createdAt || new Date().toISOString()) 
                    : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            const customerIndex = state.customers.findIndex(c => c.id === state.currentCustomer.id);
            state.customers[customerIndex].gates = state.customers[customerIndex].gates || [];
            
            // Update oder neues Tor
            if (state.currentGate.id) {
                const gateIndex = state.customers[customerIndex].gates.findIndex(g => g.id === state.currentGate.id);
                if (gateIndex >= 0) {
                    state.customers[customerIndex].gates[gateIndex] = gate;
                }
            } else {
                state.customers[customerIndex].gates.push(gate);
            }
            
            saveState();
            closeGateModal();
            state.view = 'type-select';
            resetCurrentGate();
            state.currentCustomer = state.customers[customerIndex];
            render();
        }

        function deleteGate(gateId) {
            if (!confirm('Tor wirklich l√∂schen?')) return;
            
            const customerIndex = state.customers.findIndex(c => c.id === state.currentCustomer.id);
            state.customers[customerIndex].gates = state.customers[customerIndex].gates.filter(g => g.id !== gateId);
            
            saveState();
            state.currentCustomer = state.customers[customerIndex];
            render();
        }

        function renderCustomerSelect() {
            return `
                <div class="card">
                    <div class="card-title">Kunde ausw√§hlen</div>
                    
                    <button class="btn btn-primary" onclick="openCustomerModal()" style="margin-bottom: 1.5rem;">
                        ‚ûï Neuer Kunde
                    </button>

                    ${state.customers.length === 0 ? `
                        <div class="empty-state">
                            <div class="empty-icon">üë•</div>
                            <p>Noch keine Kunden vorhanden</p>
                        </div>
                    ` : `
                        <div class="customer-grid">
                            ${state.customers.map(customer => {
                                const gates = customer.gates || [];
                                
                                return `
                                    <div class="customer-card">
                                        <div onclick="selectCustomer('${customer.id}')" style="cursor: pointer; flex: 1;">
                                            <div class="customer-name">${customer.name}</div>
                                            <div class="customer-info">
                                                ${customer.company ? `üè¢ ${customer.company}<br>` : ''}
                                                ${customer.city ? `üìç ${customer.city}<br>` : ''}
                                                ${customer.phone ? `üìû ${customer.phone}` : ''}
                                            </div>
                                            <div class="customer-gates">
                                                ${gates.length} Tor${gates.length !== 1 ? 'e' : ''}
                                            </div>
                                        </div>
                                        <div style="display: flex; gap: 0.5rem; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                                            <button class="btn btn-primary" onclick="event.stopPropagation(); editCustomer('${customer.id}')" style="flex: 1; padding: 0.5rem;">
                                                ‚úèÔ∏è Bearbeiten
                                            </button>
                                            <button class="btn btn-secondary" onclick="event.stopPropagation(); deleteCustomer('${customer.id}')" style="flex: 1; padding: 0.5rem;">
                                                üóëÔ∏è L√∂schen
                                            </button>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `}
                </div>
            `;
        }

        function renderTypeSelect() {
            return `
                <div class="card">
                    <div class="card-title">Kunde: ${state.currentCustomer.name}</div>
                    
                    <button class="btn btn-secondary" onclick="backToCustomers()" style="margin-bottom: 1.5rem;">
                        ‚Üê Zur√ºck
                    </button>

                    ${(state.currentCustomer.gates || []).length > 0 ? `
                        <h3 style="margin: 1.5rem 0 1rem; font-size: 1.1rem; color: var(--red-primary);">Gespeicherte Tore</h3>
                        <div class="gate-list">
                            ${state.currentCustomer.gates.map(gate => `
                                <div class="gate-card">
                                    <div class="gate-header">
                                        <div style="flex: 1;">
                                            <div class="gate-name">${gateTypes[gate.gateType]?.name || gate.gateType} - ${gate.name}</div>
                                            ${gate.notizen ? `<div style="color: var(--gray-dark); font-size: 0.85rem; margin-top: 0.5rem; line-height: 1.4;">${gate.notizen}</div>` : ''}
                                        </div>
                                        <div style="display: flex; gap: 0.5rem;">
                                            <button class="btn btn-primary" onclick="editGate('${gate.id}')" style="padding: 0.5rem 1rem;">
                                                ‚úèÔ∏è
                                            </button>
                                            <button class="btn btn-secondary" onclick="deleteGate('${gate.id}')" style="padding: 0.5rem 1rem;">
                                                üóëÔ∏è
                                            </button>
                                        </div>
                                    </div>
                                    <div class="gate-details">
                                        <div class="gate-detail">
                                            <span class="detail-label">Ma√üe</span>
                                            <span class="detail-value">${gate.breite} √ó ${gate.hoehe} cm</span>
                                        </div>
                                        <div class="gate-detail">
                                            <span class="detail-label">Torfl√§che</span>
                                            <span class="detail-value">${formatArea(gate.torflaeche)}</span>
                                        </div>
                                        <div class="gate-detail">
                                            <span class="detail-label">Produkte</span>
                                            <span class="detail-value">${gate.selectedProducts.length}</span>
                                        </div>
                                        <div class="gate-detail">
                                            <span class="detail-label">Aufschlag</span>
                                            <span class="detail-value">${gate.aufschlag}%</span>
                                        </div>
                                        <div class="gate-detail">
                                            <span class="detail-label">Exkl. MwSt</span>
                                            <span class="detail-value">${formatPrice(gate.exklusiveMwst)}</span>
                                        </div>
                                        <div class="gate-detail">
                                            <span class="detail-label">Inkl. MwSt</span>
                                            <span class="detail-value" style="font-size: 1.1em;">${formatPrice(gate.inklMwst)}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <h3 style="margin: 2rem 0 1rem; font-size: 1.1rem; color: var(--red-primary);">Neues Tor erstellen</h3>
                    ` : ''}

                    <div class="type-grid">
                        ${Object.entries(gateTypes).map(([type, info]) => `
                            <div class="type-card" onclick="selectGateType('${type}')">
                                ${icons[info.icon]}
                                <div class="type-name">${info.name}</div>
                                <div class="type-count">${productsByCategory[type].main.length + productsByCategory[type].accessories.length} Produkte</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderGateConfig() {
            const { gesamtflaeche, glasflaeche, torflaeche } = calculateAreas();
            const subtotal = calculateTotal();
            const aufschlagBetrag = subtotal * (state.currentGate.aufschlag / 100);
            const exklusiveMwst = subtotal + aufschlagBetrag;
            const inklMwst = exklusiveMwst * 1.2;

            const categoryData = productsByCategory[state.currentGate.gateType];
            let currentProducts = [];
            
            if (state.activeTab === 'main') {
                currentProducts = categoryData.main;
            } else if (state.activeTab === 'accessories') {
                currentProducts = categoryData.accessories;
            } else if (state.activeTab === 'general') {
                currentProducts = generalAccessories;
            }

            return `
                <div class="layout-grid">
                    <div>
                        <div class="card">
                            <div class="card-title">${gateTypes[state.currentGate.gateType].name}</div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Breite *</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="breite" value="${state.currentGate.breite}" min="0" step="any">
                                        <span class="input-unit">cm</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>H√∂he *</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="hoehe" value="${state.currentGate.hoehe}" min="0" step="any">
                                        <span class="input-unit">cm</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Glash√∂he</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="glashoehe" value="${state.currentGate.glashoehe}" min="0" step="any">
                                        <span class="input-unit">cm</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Aufschlag</label>
                                    <div class="input-with-unit">
                                        <input type="number" id="aufschlag" value="${state.currentGate.aufschlag}" min="0" max="100" step="any">
                                        <span class="input-unit">%</span>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-nav">
                                <button class="tab-btn ${state.activeTab === 'main' ? 'active' : ''}" onclick="setActiveTab('main')">
                                    Hauptprodukte (${categoryData.main.length})
                                </button>
                                <button class="tab-btn ${state.activeTab === 'accessories' ? 'active' : ''}" onclick="setActiveTab('accessories')">
                                    Zubeh√∂r (${categoryData.accessories.length})
                                </button>
                                <button class="tab-btn ${state.activeTab === 'general' ? 'active' : ''}" onclick="setActiveTab('general')">
                                    Allg. Zubeh√∂r (${generalAccessories.length})
                                </button>
                            </div>

                            <div class="product-list">
                                ${currentProducts.map(product => {
                                    const selected = state.currentGate.selectedProducts.find(p => p.id === product.id);
                                    
                                    return `
                                        <div class="product-item ${selected ? 'selected' : ''}" 
                                             data-product-id="${product.id}"
                                             onclick="toggleProduct(${product.id})">
                                            <span class="product-name">${product.name}</span>
                                            <span class="product-price">${formatPrice(product.price)} / ${product.unit}</span>
                                            ${selected ? `
                                                <input type="number" class="quantity-input" 
                                                       value="${selected.quantity}"
                                                       min="0.1" step="any"
                                                       onclick="event.stopPropagation()"
                                                       oninput="updateQuantity(${product.id}, this.value)">
                                            ` : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>

                            <div class="btn-group">
                                <button class="btn btn-secondary" onclick="backToTypeSelect()">‚Üê Zur√ºck</button>
                                <button class="btn btn-primary" onclick="openGateModal()" 
                                        ${state.currentGate.selectedProducts.length === 0 ? 'disabled' : ''}>
                                    Tor speichern
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="summary">
                        <div class="summary-title">Zusammenfassung</div>
                        
                        <div class="summary-row">
                            <span>Gesamtfl√§che</span>
                            <span class="summary-value">${formatArea(gesamtflaeche)}</span>
                        </div>
                        
                        ${state.currentGate.glashoehe > 0 ? `
                            <div class="summary-row">
                                <span>Glasfl√§che</span>
                                <span class="summary-value">${formatArea(glasflaeche)}</span>
                            </div>
                        ` : ''}
                        
                        <div class="summary-row">
                            <span>Torfl√§che</span>
                            <span class="summary-value">${formatArea(torflaeche)}</span>
                        </div>

                        ${state.currentGate.selectedProducts.length > 0 ? `
                            <div class="summary-products">
                                <strong style="display: block; margin-bottom: 0.6rem;">Produkte (${state.currentGate.selectedProducts.length})</strong>
                                ${state.currentGate.selectedProducts.slice(0, 5).map(selected => {
                                    const product = getProductById(selected.id);
                                    if (!product) return '';
                                    return `
                                        <div class="summary-product">
                                            ${product.name}<br>
                                            <small>${selected.quantity} √ó ${formatPrice(product.price)}</small>
                                        </div>
                                    `;
                                }).join('')}
                                ${state.currentGate.selectedProducts.length > 5 ? `
                                    <div style="opacity: 0.8; font-size: 0.85rem; margin-top: 0.5rem;">
                                        ... und ${state.currentGate.selectedProducts.length - 5} weitere
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}

                        <div class="summary-row" style="margin-top: 1rem;">
                            <span>Zwischensumme</span>
                            <span class="summary-value">${formatPrice(subtotal)}</span>
                        </div>
                        
                        <div class="summary-row">
                            <span>Aufschlag (${state.currentGate.aufschlag}%)</span>
                            <span class="summary-value">${formatPrice(aufschlagBetrag)}</span>
                        </div>
                        
                        <div class="summary-row">
                            <span>Exkl. MwSt.</span>
                            <span class="summary-value">${formatPrice(exklusiveMwst)}</span>
                        </div>

                        <div class="summary-total">
                            <div class="summary-row">
                                <span>Inkl. MwSt. (20%)</span>
                                <span class="summary-value">${formatPrice(inklMwst)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        let renderTimeout = null;
        
        function updateInputValue(id, value) {
            const numValue = parseFloat(value) || 0;
            const oldBreite = state.currentGate.breite;
            const oldHoehe = state.currentGate.hoehe;
            
            if (id === 'breite') state.currentGate.breite = numValue;
            else if (id === 'hoehe') state.currentGate.hoehe = numValue;
            else if (id === 'glashoehe') state.currentGate.glashoehe = numValue;
            else if (id === 'aufschlag') state.currentGate.aufschlag = numValue;
            
            // Bei √Ñnderung von Breite oder H√∂he: Hauptprodukt neu ausw√§hlen
            if ((id === 'breite' || id === 'hoehe') && state.currentGate.gateType && 
                state.currentGate.gateType !== 'T√ºren' && state.currentGate.gateType !== 'Schiebet√ºren') {
                
                // Berechne alte und neue Fl√§che
                const oldArea = (oldBreite * oldHoehe) / 10000;
                const newArea = (state.currentGate.breite * state.currentGate.hoehe) / 10000;
                
                // Alte Hauptprodukte entfernen
                const categoryData = productsByCategory[state.currentGate.gateType];
                if (categoryData) {
                    const mainProductIds = categoryData.main.map(p => p.id);
                    const oldMainProducts = state.currentGate.selectedProducts.filter(
                        p => mainProductIds.includes(p.id)
                    );
                    state.currentGate.selectedProducts = state.currentGate.selectedProducts.filter(
                        p => !mainProductIds.includes(p.id)
                    );
                    
                    // Neues Hauptprodukt ausw√§hlen
                    const selectedProductId = autoSelectMainProduct();
                    
                    // Nur scrollen wenn sich das Produkt tats√§chlich ge√§ndert hat
                    const oldProductId = oldMainProducts[0]?.id;
                    if (selectedProductId && selectedProductId !== oldProductId) {
                        // Tab wechseln
                        state.activeTab = 'main';
                        
                        // Kurzes Re-Rendering nur f√ºr Tab-Wechsel
                        const tabNav = document.querySelectorAll('.tab-btn');
                        tabNav.forEach(btn => btn.classList.remove('active'));
                        tabNav[0]?.classList.add('active');
                        
                        // Produkte neu rendern
                        renderProductList();
                        
                        // Zum ausgew√§hlten Produkt scrollen und highlighten
                        setTimeout(() => {
                            scrollToAndHighlightProduct(selectedProductId);
                        }, 100);
                    }
                }
            }
            
            // Verz√∂gertes Rendering f√ºr Summary Update (ohne komplettes Re-Rendering)
            clearTimeout(renderTimeout);
            renderTimeout = setTimeout(() => {
                renderSummaryOnly();
            }, 300);
        }
        
        function renderProductList() {
            const categoryData = productsByCategory[state.currentGate.gateType];
            let currentProducts = [];
            
            if (state.activeTab === 'main') {
                currentProducts = categoryData.main;
            } else if (state.activeTab === 'accessories') {
                currentProducts = categoryData.accessories;
            } else if (state.activeTab === 'general') {
                currentProducts = generalAccessories;
            }
            
            const productList = document.querySelector('.product-list');
            if (!productList) return;
            
            productList.innerHTML = currentProducts.map(product => {
                const selected = state.currentGate.selectedProducts.find(p => p.id === product.id);
                
                return `
                    <div class="product-item ${selected ? 'selected' : ''}" 
                         data-product-id="${product.id}"
                         onclick="toggleProduct(${product.id})">
                        <span class="product-name">${product.name}</span>
                        <span class="product-price">${formatPrice(product.price)} / ${product.unit}</span>
                        ${selected ? `
                            <input type="number" class="quantity-input" 
                                   value="${selected.quantity}"
                                   min="0.1" step="any"
                                   onclick="event.stopPropagation()"
                                   oninput="updateQuantity(${product.id}, this.value)">
                        ` : ''}
                    </div>
                `;
            }).join('');
        }
        
        function scrollToAndHighlightProduct(productId) {
            const productElement = document.querySelector(`[data-product-id="${productId}"]`);
            if (!productElement) return;
            
            // Scroll zur Produktliste
            const productList = document.querySelector('.product-list');
            if (productList) {
                const elementTop = productElement.offsetTop;
                productList.scrollTop = elementTop - 50; // Mit etwas Abstand oben
            }
            
            // Highlight-Effekt
            productElement.style.animation = 'highlight-pulse 2s ease-in-out';
            setTimeout(() => {
                productElement.style.animation = '';
            }, 2000);
        }
        
        function toggleProductList() {
            state.showAllProducts = !state.showAllProducts;
            renderSummaryOnly();
        }
        
        function renderSummaryOnly() {
            const { gesamtflaeche, glasflaeche, torflaeche } = calculateAreas();
            const subtotal = calculateTotal();
            const aufschlagBetrag = subtotal * (state.currentGate.aufschlag / 100);
            const exklusiveMwst = subtotal + aufschlagBetrag;
            const inklMwst = exklusiveMwst * 1.2;
            
            const summaryEl = document.querySelector('.summary');
            if (!summaryEl) return;
            
            // Detaillierte Produktberechnung
            let productCalculations = '';
            if (state.currentGate.selectedProducts.length > 0) {
                const productsToShow = state.showAllProducts 
                    ? state.currentGate.selectedProducts 
                    : state.currentGate.selectedProducts.slice(0, 5);
                
                productCalculations = productsToShow.map(selected => {
                    const product = getProductById(selected.id);
                    if (!product) return '';
                    
                    let calculation = '';
                    let totalPrice = 0;
                    
                    if (product.unit === 'm¬≤') {
                        // Pr√ºfe ob es ein Glas-/Fenster-Produkt ist
                        if (product.name.toLowerCase().includes('fenster') || 
                            product.name.toLowerCase().includes('glas') ||
                            product.name.toLowerCase().includes('verglasung') ||
                            product.name.toLowerCase().includes('oberlichte')) {
                            totalPrice = product.price * glasflaeche * selected.quantity;
                            calculation = `${selected.quantity} √ó ${formatPrice(product.price)}/m¬≤ √ó ${formatArea(glasflaeche)} = ${formatPrice(totalPrice)}`;
                        } else {
                            totalPrice = product.price * torflaeche * selected.quantity;
                            calculation = `${selected.quantity} √ó ${formatPrice(product.price)}/m¬≤ √ó ${formatArea(torflaeche)} = ${formatPrice(totalPrice)}`;
                        }
                    } else {
                        totalPrice = product.price * selected.quantity;
                        calculation = `${selected.quantity} √ó ${formatPrice(product.price)}/${product.unit} = ${formatPrice(totalPrice)}`;
                    }
                    
                    return `
                        <div class="summary-product" style="margin-bottom: 0.8rem;">
                            <div style="font-weight: 600; margin-bottom: 0.3rem;">${product.name}</div>
                            <small style="opacity: 0.9;">${calculation}</small>
                        </div>
                    `;
                }).join('');
            }
            
            summaryEl.innerHTML = `
                <div class="summary-title">Zusammenfassung</div>
                
                <div class="summary-row">
                    <span>Breite √ó H√∂he</span>
                    <span class="summary-value">${state.currentGate.breite} √ó ${state.currentGate.hoehe} cm</span>
                </div>
                
                <div class="summary-row">
                    <span>Gesamtfl√§che</span>
                    <span class="summary-value">${formatArea(gesamtflaeche)}</span>
                </div>
                
                ${state.currentGate.glashoehe > 0 ? `
                    <div class="summary-row">
                        <span>Glash√∂he</span>
                        <span class="summary-value">${state.currentGate.glashoehe} cm</span>
                    </div>
                    <div class="summary-row">
                        <span>Glasfl√§che</span>
                        <span class="summary-value">${formatArea(glasflaeche)}</span>
                    </div>
                ` : ''}
                
                <div class="summary-row">
                    <span>Torfl√§che</span>
                    <span class="summary-value">${formatArea(torflaeche)}</span>
                </div>

                ${state.currentGate.selectedProducts.length > 0 ? `
                    <div style="margin: 1.2rem 0; padding-top: 1rem; border-top: 2px solid rgba(255,255,255,0.2);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.8rem;">
                            <strong>Produkte (${state.currentGate.selectedProducts.length})</strong>
                            ${state.currentGate.selectedProducts.length > 5 ? `
                                <button onclick="toggleProductList()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.3rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                                    ${state.showAllProducts ? '‚ñ≤ Weniger' : '‚ñº Alle zeigen'}
                                </button>
                            ` : ''}
                        </div>
                        <div class="summary-products">
                            ${productCalculations}
                        </div>
                        ${!state.showAllProducts && state.currentGate.selectedProducts.length > 5 ? `
                            <div style="opacity: 0.8; font-size: 0.85rem; margin-top: 0.5rem; text-align: center;">
                                ... und ${state.currentGate.selectedProducts.length - 5} weitere
                            </div>
                        ` : ''}
                    </div>
                ` : ''}

                <div class="summary-row" style="margin-top: 1rem; padding-top: 1rem; border-top: 2px solid rgba(255,255,255,0.2);">
                    <span>Zwischensumme</span>
                    <span class="summary-value">${formatPrice(subtotal)}</span>
                </div>
                
                <div class="summary-row">
                    <span>Aufschlag (${state.currentGate.aufschlag}%)</span>
                    <span class="summary-value">${formatPrice(aufschlagBetrag)}</span>
                </div>
                
                <div class="summary-row">
                    <span>Exkl. MwSt.</span>
                    <span class="summary-value">${formatPrice(exklusiveMwst)}</span>
                </div>
                
                <div class="summary-row">
                    <span>MwSt. (20%)</span>
                    <span class="summary-value">${formatPrice(inklMwst - exklusiveMwst)}</span>
                </div>

                <div class="summary-total">
                    <div class="summary-row">
                        <span>Inkl. MwSt.</span>
                        <span class="summary-value">${formatPrice(inklMwst)}</span>
                    </div>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            
            if (state.view === 'customer-select') {
                app.innerHTML = renderCustomerSelect();
            } else if (state.view === 'type-select') {
                app.innerHTML = renderTypeSelect();
            } else {
                app.innerHTML = renderGateConfig();
                
                // Event Listeners f√ºr Eingabefelder - ohne sofortiges Re-Rendering
                ['breite', 'hoehe', 'glashoehe', 'aufschlag'].forEach(id => {
                    const input = document.getElementById(id);
                    if (input) {
                        input.addEventListener('input', (e) => {
                            updateInputValue(id, e.target.value);
                        });
                    }
                });
                
                // Detaillierte Summary nach dem Rendering aktualisieren
                setTimeout(() => renderSummaryOnly(), 0);
            }
            
            updateSteps();
        }

        render();
    </script>
</body>
</html>
